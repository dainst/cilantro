"use strict";angular.module("idai.components",[]),angular.module("idai.components").directive("idaiFooter",function(){return{restrict:"E",scope:{mailto:"@",institutions:"=",version:"@"},templateUrl:"partials/directives/idai-footer.html",controller:["$scope","$http","localizedContent",function(e,t,n){e.date=new Date,e.getFooterLinks=function(a){t.get("info/content.json").success(function(t){var a=n.getNodeById(t,"footer");void 0==a&&console.log("error: no footerLinks found"),n.reduceTitles(a),e.dynamicLinkList=a.children})}}],link:function(e,t,n){e.getFooterLinks(n.contentDir)}}}),angular.module("idai.components").directive("idaiForm",function(){return{restrict:"E",transclude:!0,scope:{submit:"&",doc:"="},templateUrl:"partials/directives/idai-form.html",link:function(e,t,n){e.reset=function(){e.doc={}}}}}),angular.module("idai.components").directive("idaiHeader",function(){return{restrict:"E",scope:{image:"@",description:"@",link:"@"},templateUrl:"partials/directives/idai-header.html"}}),angular.module("idai.components").directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(e,t,n){t.replaceWith(t.children())}}}),angular.module("idai.components").directive("idaiMessage",function(){return{restrict:"E",templateUrl:"partials/directives/idai-message.html",controller:["$scope","message",function(e,t){e.messages=t.getMessages(),e.removeMessage=function(e){t.removeMessage(e)}}]}}),angular.module("idai.components").directive("idaiNavbar",function(){return{restrict:"E",scope:{userObject:"=",loginFunction:"&",logoutFunction:"&",hideSearchForm:"=",hideRegisterButton:"=",hideContactButton:"=",projectId:"@"},templateUrl:"partials/directives/idai-navbar.html",controller:["$scope","$http","localizedContent","$location",function(e,t,n,a){e.getNavbarLinks=function(a){t.get("info/content.json").success(function(t){var a=n.getNodeById(t,"navbar");void 0==a&&console.log("error: no navbarLinks found"),n.reduceTitles(a),e.dynamicLinkList=a.children})},e.search=function(t){if(e.q){var n="/search?q="+e.q;t&&(n+="&fq="+t),e.q=null,a.url(n)}},e.toggleNavbar=function(){e.isCollapsed=!0,e.$on("$routeChangeSuccess",function(){e.isCollapsed=!0})}}],link:function(e,t,n){e.getNavbarLinks(n.contentDir)}}}),angular.module("idai.components").directive("idaiPicker",function(){return{restrict:"E",scope:{searchUri:"@",resultField:"@",titleField:"@",totalField:"@",queryParam:"@",limitParam:"@",offsetParam:"@",addParams:"=",selectedItem:"="},templateUrl:"partials/directives/idai-picker.html",controller:["$scope","$parse","$uibModal",function(e,t,n){e.openModal=function(){var t=n.open({templateUrl:"picker_modal.html",controller:"PickerModalController",bindToController:!0,size:"lg",scope:e});t.result.then(function(t){e.selectedItem=t})},e.$watch("titleField",function(n){n||(n="title"),e.getTitleField=t(n)})}]}}).controller("PickerModalController",["$scope","$http","$q","$parse","$uibModalInstance",function(e,t,n,a,i){var l;e.result,e.total=0,e.offset=0,e.limit=10,e.loading=!1,e.preselect=0;var r=function(){if(l&&l.resolve(),e.query){e.loading=!0,l=n.defer(),e.queryParam||(e.queryParam="q"),e.limitParam||(e.limitParam="limit"),e.offsetParam||(e.offsetParam="offset");var i=e.searchUri+"?"+e.queryParam+"="+e.query;i+="&"+e.limitParam+"="+e.limit,i+="&"+e.offsetParam+"="+e.offset,e.addParams&&angular.forEach(e.addParams,function(e,t){i+="&"+t+"="+e}),t.get(i,{timeout:l.promise}).then(function(t){e.resultField||(e.resultField="result");var n=a(e.resultField);0==e.offset?e.result=n(t.data):e.result=e.result.concat(n(t.data)),e.totalField||(e.totalField="total");var i=a(e.totalField);e.total=i(t.data),e.loading=!1})}else e.result=[],e.total=0};e.more=function(){e.offset+=e.limit,r()},e.keydown=function(t){40==t.keyCode&&e.preselect<e.result.length-1?e.preselect++:38==t.keyCode&&e.preselect>0&&e.preselect--},e.keypress=function(t){13==t.keyCode&&(e.total>0&&e.query==e.lastQuery?(t.stopPropagation(),e.selectItem(e.result[e.preselect])):e.newQuery())},e.newQuery=function(){e.lastQuery=e.query,e.offset=0,r()},e.open=function(e){window.open(e,"_blank")},e.selectItem=function(e){i.close(e)},e.$watch("titleField",function(t){t||(t="title"),e.getTitleField=a(t)})}]),angular.module("idai.components").filter("transl8",["transl8",function(e){var t=function(t){if("undefined"!=typeof t){var n;try{n=e.getTranslation(t)}catch(a){var i="TRL8 MISSING ('"+t+"')";return console.log(i),i}return n}};return t.$stateful=!0,t}]),angular.module("idai.components").factory("header",function(){}),angular.module("idai.components").factory("language",function(){var e=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage;return"undefined"==typeof e?e="de":("de"==e.substring(0,2)&&(e="de"),"en"==e.substring(0,2)&&(e="en")),{browserPrimaryLanguage:function(){return e}}}),angular.module("idai.components").factory("languageSelection",["language",function(e){var t="de",n="en";return{__:function(a,i,l){return e.browserPrimaryLanguage()==t?void i(t,l):void(a(e.browserPrimaryLanguage(),l)?i(e.browserPrimaryLanguage(),l):e.browserPrimaryLanguage()==n?i(t,l):a(n,l)?i(n,l):i(t,l))}}}]),angular.module("idai.components").factory("localizedContent",["languageSelection",function(e){return{reduceTitles:function(t){var n=function(e,t){t.title&&(t.title=t.title[e])},a=function(e,t){return t.title?t.title[e]:!1},i=function(t){if(e.__(a,n,t),t.children)for(var l=0;l<t.children.length;l++)i(t.children[l])};i(t)},determineLanguage:function(t,n){var a="",i=function(e,t){var a=function(t){if(t.id==n&&t.title[e])return!0;if(t.children)for(var i=0;i<t.children.length;i++)if(a(t.children[i]))return!0;return!1};return!!a(t)},l=function(e){a=e};return e.__(i,l,t),a},getNodeById:function(e,t){var n=function(e,t){if(e.id==t)return e;if(e.children){for(var a=void 0,i=0;i<e.children.length;i++){var l=n(e.children[i],t);void 0!=l&&(a=l)}return a}};return n(e,t)}}}]),angular.module("idai.components").factory("message",["$rootScope","transl8","$sce",function(e,t,n){function a(e){this.text=t.getTranslation(e),this.text=n.trustAsHtml(this.text),this.level="warning",this.contactInfo=t.getTranslation("components.message.contact").replace("CONTACT","arachne@uni-koeln.de")}function i(e){return-1===["success","info","warning","danger"].indexOf(e)}function l(){angular.forEach(o,function(e,t){delete o[t]})}function r(e){return o[e]=new a(e),o[e]}var o={},s=!0;return e.$on("$locationChangeSuccess",function(){s&&l(),s=!0}),{dontClearOnNextLocationChange:function(){s=!1},addMessageForCode:function(e,t,n){var a=r(e);if(t){if(i(t))throw new Error("If used, level must be set to an allowed value.");a.level=t}0!=n&&"success"!=a.level||delete a.contactInfo},removeMessage:function(e){delete o[e]},clear:function(){l()},getMessages:function(){return o}}}]),angular.module("idai.components").factory("transl8",["$http","language","componentsSettings",function(e,t,n){var a="en",i="de",l=a,r=!1,o={};t.browserPrimaryLanguage()==i&&(l=i);var s=n.transl8Uri.replace("{LANG}",l),c=e.jsonp(s).success(function(e){for(var t=0;t<e.length;t++)o[e[t].key]=e[t].value;r=!0}).error(function(){alert("ERROR: Could not get translations. Try to reload the page or send a mail to arachne@uni-koeln.de")});return{getTranslation:function(e){if(!r)return"";var t=o[e];if(!t||0===t.length)throw new Error("No translation found for key '"+e+"'");return t},onLoaded:function(){return c}}}]),function(e){try{e=angular.module("idai.templates")}catch(t){e=angular.module("idai.templates",[])}e.run(["$templateCache",function(e){e.put("partials/directives/idai-footer.html",'<div class=row><div class="col-md-12 text-center"><p><a ng-repeat="(key, uri) in institutions" ng-href={{uri}}><img class=logoImage ng-src=img/logo_{{key}}.png></a></p><p>{{\'footer_licensed_under\'|transl8}} <a rel=license href=info/order>Creative Commons</a> | <span ng-repeat="link in dynamicLinkList"><a href=info/{{link.id}}>{{link.title}}</a> |</span> {{\'footer_bugs_to\'|transl8}} <a href=mailto:{{mailto}}>{{mailto}}</a></p><p ng-show=version><small>{{version}}</small></p></div></div>')}])}(),function(e){try{e=angular.module("idai.templates")}catch(t){e=angular.module("idai.templates",[])}e.run(["$templateCache",function(e){e.put("partials/directives/idai-form.html",'<form name=form class=form-horizontal><ng-transclude></ng-transclude><div class=form-group><div class="col-sm-offset-3 col-sm-9"><button ng-click=submit() class="btn btn-primary" ng-class="{ disabled: form.$invalid }">{{ \'form_save\' | transl8 }}</button> <button ng-click=reset() class="btn btn-link">{{ \'form_reset\' | transl8 }}</button></div></div></form>')}])}(),function(e){try{e=angular.module("idai.templates")}catch(t){e=angular.module("idai.templates",[])}e.run(["$templateCache",function(e){e.put("partials/directives/idai-header.html",'<a ng-href={{link}} id=headerlink><header id=teaser><div id=background style="background-image: url({{image}});"></div><div id=description>{{description}}</div></header></a>')}])}(),function(e){try{e=angular.module("idai.templates")}catch(t){e=angular.module("idai.templates",[])}e.run(["$templateCache",function(e){e.put("partials/directives/idai-message.html",'<div ng-repeat="(transl8Key,message) in messages" ng-class="\'alert-\' + message.level" class="col-md-10 col-md-offset-1 alert text-center"><div class=alert-message><button class=close ng-click=removeMessage(transl8Key) style=cursor:pointer;>&times;</button> <b ng-bind-html=message.text></b><br><span>{{message.contactInfo}}</span></div></div>')}])}(),function(e){try{e=angular.module("idai.templates")}catch(t){e=angular.module("idai.templates",[])}e.run(["$templateCache",function(e){e.put("partials/directives/idai-navbar.html",'<nav class="navbar navbar-default navbar-fixed-top" role=navigation><div style="padding-left:0px; position:relative"><div class=pull-left><ul class="nav navbar-nav"><li uib-dropdown><a href=# uib-dropdown-toggle><img src=img/kleinergreif.png id=brand-img> <b class=caret></b></a><ul uib-dropdown-menu><li><a href=http://www.dainst.org/de/forschung/forschung-digital/idai.welt target=_blank>iDAI.welt</a></li><li class=divider></li><li><a href="https://gazetteer.dainst.org/" target=_blank>iDAI.gazetteer</a></li><li><a href="http://geoserver.dainst.org/" target=_blank>iDAI.geoserver</a></li><li><a href="http://arachne.uni-koeln.de/" target=_blank>iDAI.objects&nbsp;/&nbsp;Arachne</a></li><li><a href=http://zenon.dainst.org target=_blank>iDAI.bibliography&nbsp;/&nbsp;Zenon</a></li><li><a href=http://archwort.dainst.org/thesaurus/de/vocab target=_blank>iDAI.vocab</a></li><li><a href=http://hellespont.dainst.org target=_blank>Hellespont</a></li></ul></li></ul></div><a href="/" id=projectLogo><img class=pull-left ng-src=img/logo_{{projectId}}.png style="height: 36px; margin-top: 8px;"></a></div><div class=navbar-header ng-init="isCollapsed = true"><button class=navbar-toggle ng-click="isCollapsed = !isCollapsed" type=button><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button><form id=navbar-search ng-submit=search() ng-hide=hideSearchForm class="navbar-left navbar-form input-group form-inline" role=search><input autofocus type=text class=form-control placeholder="neue Suche" ng-model=q name=q> <span class="navbar-left input-group-btn"><button type=submit class="btn btn-default"><span class="glyphicon glyphicon-search"></span></button></span></form></div><div ng-class="isCollapsed ? \'collapse\' : \'in\'" class="collapse navbar-collapse" uib-collapse=isCollapsed style=padding-left:10px><ul class="nav navbar-nav navbar-right"><li ng-repeat="link in dynamicLinkList"><a ng-click=toggleNavbar() ng-href=info/{{link.id}}>{{link.title}}</a></li><li><div ng-if=userObject.username ng-cloak uib-dropdown keyboard-nav><a href=bookmarks class="btn btn-default btn-sm navbar-btn" uib-dropdown-toggle><span class="glyphicon glyphicon-user"></span> &nbsp;{{userObject.username}} <span class=caret></span></a><ul uib-dropdown-menu role=menu style="margin-top:-11px; margin-right: 4px;"><div ng-include="\'partials/navbar-menu.html\'" include-replace></div><li class=divider></li><li><a ng-click=logoutFunction();><span class="glyphicon glyphicon-log-out"></span> &nbsp;{{\'navbar_sign_out\' | transl8}}</a></li></ul></div><div ng-if=!userObject.username ng-cloak class="btn-group btn-group-sm"><a type=button class="btn btn-default navbar-btn" ng-click=loginFunction();><b><span class="glyphicon glyphicon-log-in"></span> &nbsp;{{\'navbar_sign_in\' | transl8}}</b></a> <a ng-if="!hideRegisterButton && !userObject.username" class="btn btn-default navbar-btn" href=register>{{\'navbar_sign_up\' | transl8}}</a></div></li><li ng-if=!hideContactButton style=margin-left:5px><div><a type=button href=contact class="btn btn-sm btn-default navbar-btn"><span class="glyphicon glyphicon-envelope"></span></a></div></li><li style=margin-right:30px></li></ul></div></nav>')}])}(),function(e){try{e=angular.module("idai.templates")}catch(t){e=angular.module("idai.templates",[])}e.run(["$templateCache",function(e){e.put("partials/directives/idai-picker.html",'<div class=idai-picker><script type=text/ng-template id=picker_modal.html><div class="panel panel-default picker-modal"> <div class="panel-heading"> <form class="input-group"> <input ng-keydown="keydown($event)" ng-keypress="keypress($event)" type="text" ng-model="query" class="form-control" autofocus></input> <span class="input-group-btn"> <button ng-click="newQuery()" class="btn btn-default"> <span class="glyphicon glyphicon-search"></span> </button> </span> </form> </div> <div class="panel-body"> <div ng-if="loading" class="loading"></div> <em ng-show="result && total == 0 && !loading">{{ \'picker_no_result\' | transl8 }}</em> <em ng-show="!result && total == 0 && !loading">{{ \'picker_perform_search\' | transl8 }}</em> <div ng-show="total > 0 && !loading" class="text-center small"> <b><i>{{ total | number }} {{ \'results\' | transl8 }}</i></b> </div> </div> <div class="list-group" style="max-height:470px; overflow-y: auto;"> <a href="#" ng-repeat="item in result" class="list-group-item" ng-click="selectItem(item)" ng-class="{ preselected: $index == preselect }"> <div class="row"> <div ng-class="{ \'col-sm-8\': item[\'@id\'], \'col-sm-12\': !item[\'@id\']}"> <span ng-class="{ invisible: $index != preselect }" class="glyphicon glyphicon-menu-right small"></span> {{ getTitleField(item) }} </div> <div class="col-sm-4 text-right" ng-show="item[\'@id\']"> <button class="btn btn-link btn-xs" ng-click="open(item[\'@id\'])" style="padding:0px 5px 1px; border: 0;"> {{ item[\'@id\'] }} <span class="glyphicon glyphicon-new-window" style="font-size:0.8em"></span> </button> </div> </div> </a> <a ng-show="total > offset + limit" href="#" class="list-group-item text-center" ng-click="more()"> ... </a> </div> </div></script><div class=input-group><span class=input-group-btn><button class="btn btn-default" type=button ng-click=openModal()><span class="glyphicon glyphicon-link"></span></button></span> <span class=form-control><span ng-show=!selectedItem>{{ \'pick_an_item\' | transl8 }}</span> <a ng-show="selectedItem && selectedItem[\'@id\']" ng-href="{{ selectedItem[\'@id\'] }}" target=_blank>{{ getTitleField(selectedItem) }}</a> <span ng-show="selectedItem && !selectedItem[\'@id\']">{{ getTitleField(selectedItem) }}</span> <button class="btn btn-link btn-xs" ng-show=selectedItem ng-click="selectedItem = undefined"><span class="glyphicon glyphicon-remove-sign text-muted"></span></button></span></div></div>')}])}();